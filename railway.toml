[[services]]
name = "Themis"
source = "."
watch = ["apps/api/**"]

[services.build]
builder = "NIXPACKS"
buildCommand = "pnpm install --frozen-lockfile && cd apps/api && pnpm prisma generate && pnpm build"

[services.deploy]
startCommand = "cd apps/api && npx prisma migrate deploy && node dist/main.js"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
